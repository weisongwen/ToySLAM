<launch>
    <!-- Arguments -->
    <arg name="save_map" default="false"/>
    <arg name="save_trajectory" default="false"/>
    <arg name="map_path" default="$(find ToySLAM)/maps/ndt_map.pcd"/>
    <arg name="trajectory_path" default="$(find ToySLAM)/maps/ndt_trajectory.txt"/>
    <arg name="fixed_frame" default="map"/>
    <arg name="base_frame" default="base_link"/>
    <arg name="odom_frame" default="odom"/>
    
    <!-- NDT LiDAR Odometry Node -->
    <node pkg="ToySLAM" type="loam_mapping_node" name="loam_mapping_node" output="screen">
        <!-- Frame settings -->
        <param name="fixed_frame" value="$(arg fixed_frame)"/>
        <param name="base_frame" value="$(arg base_frame)"/>
        <param name="odom_frame" value="$(arg odom_frame)"/>
        
        <!-- NDT parameters (very conservative) -->
        <param name="ndt_resolution" value="3.0"/>
        <param name="ndt_step_size" value="0.1"/>
        <param name="ndt_epsilon" value="0.01"/>
        <param name="ndt_max_iterations" value="10"/>
        
        <!-- Filtering parameters -->
        <param name="voxel_leaf_size" value="1.0"/>
        <param name="downsample_leaf_size" value="0.8"/>
        
        <!-- Motion parameters with strict constraints -->
        <param name="min_scan_range" value="1.0"/>
        <param name="max_scan_range" value="80.0"/>
        <param name="scan_period" value="0.1"/>
        <param name="min_add_scan_shift" value="0.5"/>
        <param name="min_add_scan_yaw_diff" value="0.05"/>
        <param name="max_linear_velocity" value="2.0"/>
        <param name="max_angular_velocity" value="0.5"/>
        <param name="recovery_counter_max" value="5"/>
        
        <!-- Smoothing parameters -->
        <param name="smoothing_window_size" value="5"/>
        <param name="keyframe_queue_size" value="5"/>
        
        <!-- General settings -->
        <param name="use_odom" value="false"/>
        <param name="publish_tf" value="true"/>
        <param name="publish_map_points" value="true"/>
        
        <!-- Output options -->
        <param name="save_map" value="$(arg save_map)"/>
        <param name="save_trajectory" value="$(arg save_trajectory)"/>
        <param name="map_save_path" value="$(arg map_path)"/>
        <param name="trajectory_save_path" value="$(arg trajectory_path)"/>
    </node>
    
    <!-- Visualize in RVIZ -->
    <!-- <node launch-prefix="nice" pkg="rviz" type="rviz" name="rviz" 
          args="-d $(find ToySLAM)/rviz/ndt_odometry.rviz" respawn="true"/> -->
</launch>